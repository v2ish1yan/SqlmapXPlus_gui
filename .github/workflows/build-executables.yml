name:  Build  and  Release

on:
    push:
      branches:
        -  main   

jobs:
    build-and-release:
      runs-on:  ubuntu-latest
      steps:
      -  uses:  actions/checkout@v2

      -  name:  Set  up  Python  3.8.8
        uses:  actions/setup-python@v2
        with:
          python-version:  3.8.8

      -  name:  Install  pyinstaller
        run:  |
          python  -m  pip  install  pyinstaller

      -  name:  Build  Windows  executable
        run:  |
          pyinstaller  --onefile  --platform  windows.x86_64  --add-data  'main.py;.'  main.py
        env:
          PYTHONIOENCODING:  utf-8

      -  name:  Build  macOS  executable
        run:  |
          pyinstaller  --onefile  --platform  darwin.x86_64  --add-data  'maint.py;.'  main.py
        env:
          PYTHONIOENCODING:  utf-8

      -  name:  Build  Linux  executable
        run:  |
          pyinstaller  --onefile  --platform  linux.x86_64  --add-data  'main.py;.'  main.py
        env:
          PYTHONIOENCODING:  utf-8

      -  name:  Create  Release
        id:  create_release
        uses:  actions/create-release@v1
        env:
          GITHUB_TOKEN:  ${{  secrets.GITHUB_TOKEN  }}
        with:
          tag_name:  ${{  github.ref  }}
          release_name:  Release  ${{  github.ref  }}
          draft:  false
          prerelease:  false

      -  name:  Upload  Release  Assets
        uses:  actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN:  ${{  secrets.GITHUB_TOKEN  }}
        with:
          upload_url:  ${{  steps.create_release.outputs.upload_url  }}
          asset_path:  ./dist/*
          asset_name:  gui_win
          asset_content_type:  application/octet-stream

