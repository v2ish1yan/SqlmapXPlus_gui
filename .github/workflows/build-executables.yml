name:  AutoRelease  Executable

on:
    push:
      branches:
        -  main    #  你希望自动发布  Release  的分支

jobs:
    build-and-release:
      runs-on:  ${{  matrix.os  }}
      strategy:
        matrix:
          os:  [windows-latest,  macos-latest,  ubuntu-latest]
      steps:
      -  uses:  actions/checkout@v2

      -  name:  Set  up  Python
         uses:  actions/setup-python@v2
         with:
          python-version:  3.x

      -  name:  Install  pyinstaller
         run:  pip  install  pyinstaller

      -  name:  Create  executable
         run:  |
          pyinstaller  --onefile  main.py
          mkdir  -p  ./release/${{  matrix.os  }}
          mv  dist/main  ./release/${{  matrix.os  }}/main-${{  matrix.os  }}

      -  name:  Create  Release
         id:  create_release
         uses:  actions/create-release@v1
         env:
          GITHUB_TOKEN:  ${{  secrets.GITHUB_TOKEN  }}
         with:
          tag_name:  v${{  github.ref  }}
          release_name:  Release  v${{  github.ref  }}
          draft:  false
          prerelease:  false

      -  name:  Upload  Release  Asset
         uses:  actions/upload-release-asset@v1
         env:
          GITHUB_TOKEN:  ${{  secrets.GITHUB_TOKEN  }}
         with:
          upload_url:  ${{  steps.create_release.outputs.upload_url  }}
          asset_path:  ./release/${{  matrix.os  }}/main-${{  matrix.os  }}
          asset_name:  main-${{  matrix.os  }}
          asset_content_type:  application/octet-stream
